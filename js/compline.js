require.config({baseUrl:"js"}),require(["jquery","moment","calendar","chant-element"],function(e,a,t){"use strict";function n(a,t){var n=e("a[toggle="+a+"]");switch("undefined"==typeof t&&(t=g[a]()),n.text(n.attr("toggle-"+t.toString())),a){case"autoSelectRegion":e("#selectRegion").prop("disabled",t);break;case"fullNotationPrayers":e(".notated-prayer").toggle(t),e(".pointed-prayer").toggle(!t)}}function o(){e.getJSON("https://freegeoip.net/json/",function(e){if(e.country_code in t.roman.regionCodeMap)f(e.country_code);else{var a=e.country_code+"-"+e.region_code;a in t.roman.regionCodeMap?f(a):console.info("Unknown Region:",e)}console.info("Country: "+e.country_name+"\nCode: "+e.country_code),window.ipGeo=v=e})}function i(){var a=h();e("input:radio:not(.not-hideable)").parent().toggle(a),e("#marian-antiphon-choices>select").toggle(a),e(".marian-antiphon-name").toggle(!a),a||e("input:radio:checked").parent().show()}var r="",c=window.localStorage;try{var s="__storage test__";c.setItem(s,s),c.removeItem(s)}catch(l){c={}}"region"in c||(c.region=""),"fullNotation"in c||(c.fullNotation="0"),"fullNotationPrayers"in c||(c.fullNotationPrayers="0"),"showOptions"in c||(c.showOptions="0"),"autoSelectRegion"in c||(c.autoSelectRegion="1");var u={};e("#selectRegion").append('<option value="">None</option>'+Object.keys(t.roman.regionCodeMap).map(function(e){var a=t.roman.regionCodeMap[e];return a in u?"":(u[a]="",'<option value="'+e+'"">'+a+"</option>")}).join("")).val(c.region);var d=e("#options-menu");e(document.body).click(function(a){var t=e(a.target);t.parents().is(d)?t.is("a,input,select")||d.toggleClass("showing"):d.removeClass("showing")});var g={},p=g.fullNotation=function(e){return"undefined"==typeof e?!!parseInt(c.fullNotation):(n("fullNotation",!!e),c.fullNotation=e?1:0,D(),void R())},h=(g.fullNotationPrayers=function(e){return"undefined"==typeof e?!!parseInt(c.fullNotationPrayers):(n("fullNotationPrayers",!!e),void(c.fullNotationPrayers=e?1:0))},g.showOptions=function(e){return"undefined"==typeof e?!!parseInt(c.showOptions):(n("showOptions",!!e),c.showOptions=e?1:0,void i())}),f=(g.autoSelectRegion=function(e){return"undefined"==typeof e?!!parseInt(c.autoSelectRegion):(n("autoSelectRegion",!!e),c.autoSelectRegion=e?1:0,void(e&&o()))},function(a){return"undefined"==typeof a?!!parseInt(c.autoSelectRegion):(e("#selectRegion").val(a),r="",void(c.region=e("#selectRegion").val()))});e("a[href][toggle]").click(function(a){a.preventDefault();var t=e(this),n=g[t.attr("toggle")];n(!n())}),e("#selectRegion").change(function(a){f(e(this).val())}),e.each(g,function(e){n(e)});var v;parseInt(c.autoSelectRegion)&&o(),e.QueryString=function(e){if(""===e)return{};for(var a={},t=0;t<e.length;++t){var n=e[t].split("=");2==n.length&&(a[n[0]]=decodeURIComponent(n[1].replace(/\+/g," ")))}return a.successMsg&&showAlert(!1,a.successMsg),a.failMsg&&showAlert(!0,a.failMsg),a}(window.location.search.substr(1).split("&"));var y=a();e("#date").val(y.format("YYYY-MM-DD"));var m=function(e){return function(t,n){var o=a(n);return o.isValid()?o.add(e,"days"):o=a(),o.format("YYYY-MM-DD")}},b=function(a){e("#date").val(m(a?7:1)).change()},w=function(a){e("#date").val(m(a?-7:-1)).change()};e(document).on("keypress",function(e){switch(e.which){case 106:case 74:w(e.shiftKey);break;case 107:case 75:b(e.shiftKey)}});var k,S=y.day(),M=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if(e.QueryString.day){var I=e.QueryString.day;I in M?S=I:(I=M.indexOf(I),I in M&&(S=I))}var N="",R=function(a){a="undefined"==typeof a?N.replace(/_full$/,""):a;var t=a;if(p()&&(a+="_full"),a!==N){N=a;var n="<chant-gabc src='canticle-ant"+t+".gabc'></chant-gabc>";"-pt"===t&&(t="",a=a.slice(3));var o="<chant-gabc src='canticle-psalm"+a+".gabc'></chant-gabc>",i=function(a){var i=n+o+a;i+="-po"===t?"<chant-gabc src='haec-dies.gabc'></chant-gabc>":n,e("#canticle").empty().append(i)};e("#canticle").empty(),p()?i(""):e.get("canticle-psalm"+a+".html",i)}},C={},D=function(a,t,n){if("undefined"==typeof a?(a=C.day,t=C.paschalTime,n=C.isSunday):(C.day=a,C.paschalTime=t,C.isSunday=n),!("undefined"==typeof a&&"undefined"==typeof t&&"undefined"==typeof n||C.day==a&&C.paschalTime==t&&C.isSunday==n&&C.full==p())){C.fullNotation=p();var o="",i="",r="",c=p()?"_full":"";"triduum"===a?(a=0,r="-triduum",c=""):"asd"===a?(r="",i="<chant-gabc src='psalms/"+a+"/psalm"+r+c+".gabc'></chant-gabc>"):(r=t?"-PT":"",o=t?"<chant-gabc src='psalms/ant-PT.gabc'></chant-gabc>":"<chant-gabc src='psalms/"+a+"/ant.gabc'></chant-gabc>","no-antiphon"===t&&(o=""),i="<chant-gabc src='psalms/"+a+"/psalm"+r+c+".gabc'></chant-gabc>",k=M[a],n||e("#weekday").text(k));var s=function(a){var t=o+i+a+o;e("#placeholder").empty().append(t)};c?s(""):e.get("psalms/"+a+"/psalm-verses"+r+".html",s).fail(function(){e.get("psalms/"+a+"/psalm-verses.html",s)})}},_=function(e){switch(e){case 1:return"I Class";case 2:return"II Class";case 3:return"III Class";case 5:return"Commemoration";default:return"Feria"}},P=function(a,n){var o=t.datesForMoment(a),c=t.getFeastForDate(a,n);e("[exclude]").each(function(){var n=e(this);n.toggle(!t.dateMatches(a,n.attr("exclude")))}),e("[include]").each(function(){var n=e(this);n.toggle(t.dateMatches(a,n.attr("include")))});var s=function(e){var n=e.attr("select-day");n=!n||t.dateMatches(a,n);var o=t.dateMatches(a,e.attr("select-date"));return o&&n};e("input[select-date]").each(function(){var a=e(this),t=s(a);if(t)a.prop("checked",!0).change();else{var n=a.siblings("input[name="+a.attr("name")+"]");1!=n.length||n.is("[select-date]")||n.prop("checked",!0).change()}}),e("option[select-date]").each(function(){var a=e(this),t=s(a);if(t)a.parent().val(a.val()).change();else{var n=a.siblings("option");1!=n.length||n.is("[select-date]")||a.parent().val(n.val()).change()}});var l=o.isPaschalTime(a),u=0!==a.day();if(l&&o.isPaschalWeek(a))u=!1,D(0,"no-antiphon",!0),R("-po"),e("#weekday").text("Easter "+M[a.day()]);else if(o.isTriduum(a)){u=!1;var d=a.day();D("triduum");var g;switch(d){case 4:g="Maundy Thursday";break;case 5:g="Good Friday";break;case 6:g="Holy Saturday"}e("#weekday").text(g)}else t.dateMatches(a,"allSouls")?(u=!1,e("#weekday").text("All Souls Day"),D("asd"),R("-asd")):(D(a.day(),l),R(l?"-pt":""));e(".chooseDay").toggle(u);var p=e("#rbWeekday").prop("value",a.day());if(c.alternates){var h=e("#selectFeastDay");h.empty().append(c.alternates.map(function(e,a){return'<option value="'+(e.region&&e.region[0]||"")+'">'+e.title+(e.rank<5?" ("+_(e.rank)+")":"")+(e.region?" ["+e.region.join(", ")+"]":"")+"</option>"}).join("")),h.val(r)}else e("#feastDay").text(c.title+(c.rank<5?" ("+_(c.rank)+")":""));e("#feastDay").toggle(!c.alternates),e("#selectFeastDay").toggle(!!c.alternates),c&&c.rank<=2?e("#rbSunday").prop("checked",!0):p.prop("checked",!0),i()},T=function(e,a){e&&0!==e.length&&(e.attr("src",a),e.get(0).setSrc(a))};e("input[name=weekday]").change(function(){this.checked&&D(parseInt(this.value),"paschal"==F.season,!0)});var x=function(a,t,n){var o=a+"/"+t+".gabc";T(e("#"+a),o);var i=e("chant-gabc["+n+"]");i.length>0&&T(i,i.attr(n)),e("div."+a).hide(),e("div."+a+"."+t).show()},F={};e("[id$=-choices] input[type=radio]").change(function(){var e=this.name;F[e]=this.value,"season"!=e&&x(e,this.value,this.id)}),e("#marian-antiphon-choices select,#marian-antiphon-solemn").change(function(){var a=e("#marian-antiphon-choices select"),t=e("#marian-antiphon-solemn").prop("checked"),n="marian-antiphon",o=a.val(),i=a.find("option[value="+o+"]").prop("id");t&&(o+="-solemn",i+="-solemn"),F[n]=o,x(n,o,i)});var O=e("#date");O.change(function(){this.value&&P(a(this.value))}).change(),e("#selectFeastDay").change(function(){r=this.value,P(a(O.val()))})});