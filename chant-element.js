$(function(t){"use strict";var e=/((?:[\w-_]+:\s*[^;\r\n]*;?\r?\n)+)%%\r?\n/,n=window.document.body.clientWidth,a=function(){n=window.document.body.clientWidth,t("chant-gabc").each(function(){this.doLayout(n)})};window.addEventListener?window.addEventListener("resize",a,!1):window.attachEvent&&window.attachEvent("onresize",a);var i=Object.create(HTMLElement.prototype);i.setSrc=function(e){var n=this,a=t(this);if(e=e||a.attr("src")){this._width=0;var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&200===i.status&&a.attr("src")===e&&n.setGabc(i.responseText)},i.open("GET",e,!0),i.send(null)}},i.doLayout=function(t){var e=this._score,n=this._ctxt;if(t=t||this.parentElement&&this.parentElement.clientWidth||window.document.body.clientWidth,0!==t&&this._width!==t){for(var a=this._width=t,i="",r=0;r<e.length;++r)(e[r].userNotes||e[r].commentary)&&(i+="<br>"),e[r].userNotes&&(i+="<i>"+e[r].userNotes+"</i>"),e[r].commentary&&(i+='<i style="float:right">'+e[r].commentary+"</i>"),e[r].performLayout(n),e[r].layoutChantLines(n,a),i+=e[r].createSvg(n);this.innerHTML=i}},i.setGabc=function(t,a){var i=[],r=this.getAttribute("use-drop-cap");r="false"!==r;var s=this._mappings=[],o=this._score=[],c=this._ctxt;t=t.replace(/<v>\\([VRA])bar<\/v>/g,function(t,e){return e+"/."}).replace(/(<b>[^<]+)<sp>'(?:oe|œ)<\/sp>/g,"$1œ</b>́<b>").replace(/<b><\/b>/g,"").replace(/<sp>'(?:ae|æ)<\/sp>/g,"ǽ").replace(/<sp>'(?:oe|œ)<\/sp>/g,"œ́").replace(/<v>\\greheightstar<\/v>/g,"*");var h=t.split(e);1===h.length&&h.splice(0,"","");for(var u=(h.length-1)/2,l=0;l<u;++l){var d=h[2*l+1].split(/\r?\n/);t=h[2*l+2].replace(/([^c])u([aeiouáéíóú])/g,"$1u{$2}").replace(/<\/?sc>/g,"%").replace(/<\/?b>/g,"*").replace(/<\/?i>/g,"_").replace(/(\s)_([^\s*]+)_(\(\))?(\s)/g,"$1^_$2_^$3$4").replace(/(\([cf][1-4]\)|\s)(\d+\.)(\s\S)/g,"$1^$2^$3"),s[l]=exsurge.Gabc.createMappingsFromSource(c,t),d&&(d=d.reduce(function(t,e){var n=e.match(/^%?([\w-_]+):\s*([^;\r\n]*)(?:;|$)/i);return n&&(t[n[1]]=n[2]),t},{}),"initial-style"in d&&(i[l]="1"===d["initial-style"])),l in i||(i[l]=r),o[l]=new exsurge.ChantScore(c,s[l],i[l]),d&&d.annotation&&i[l]?o[l].annotation=new exsurge.Annotation(c,d.annotation):a&&(o[l].annotation=new exsurge.Annotation(c,a)),d&&d["user-notes"]&&(o[l].userNotes=d["user-notes"]),d&&d.commentary&&(o[l].commentary=d.commentary)}this.doLayout(n)},i.createdCallback=function(){var t=new exsurge.ChantContext;t.lyricTextFont="'Crimson Text', serif",t.lyricTextSize*=1.2,t.dropCapTextFont=t.lyricTextFont,t.annotationTextFont=t.lyricTextFont,this._ctxt=t;var e=this.getAttribute("src");e?this.setSrc(e):setGabc(this.innerText,this.getAttribute("annotation")),this._width=0,this._attached=!1},i.attachedCallback=function(){this._attached=!0};document.registerElement("chant-gabc",{prototype:i})});