$(function(t){"use strict";var e=Object.create(HTMLElement.prototype);e.createdCallback=function(){var e=/((?:[\w-_]+:\s*[^;\r\n]*;?\r?\n)+)%%\r?\n/,n=new exsurge.ChantContext,r=this,a=t(this);n.lyricTextFont="'Crimson Text', serif",n.lyricTextSize*=1.2,n.dropCapTextFont=n.lyricTextFont,n.annotationTextFont=n.lyricTextFont;var i,o=this.getAttribute("use-drop-cap");o="false"!==o;var s,c,u=function(t,r){i=[],s=[],c=[],t=t.replace(/<v>\\([VRA])bar<\/v>/g,function(t,e){return e+"/."}).replace(/<\/?sc>/g,"%").replace(/<\/?b>/g,"*").replace(/<\/?i>/g,"_").replace(/<sp>'(?:ae|æ)<\/sp>/g,"æ").replace(/<v>\\greheightstar<\/v>/g,"*");var a=t.split(e);1===a.length&&a.splice(0,"","");for(var u=(a.length-1)/2,l=0;l<u;++l){var g=a[2*l+1].split(/\r?\n/);t=a[2*l+2].replace(/(\s)_([^\s*]+)_(\(\))?(\s)/g,"$1^_$2_^$3$4").replace(/(\([cf][1-4]\)|\s)(\d+\.)(\s\S)/g,"$1^$2^$3"),s[l]=exsurge.Gabc.createMappingsFromSource(n,t),g&&(g=g.reduce(function(t,e){var n=e.match(/^([\w-_]+):\s*([^;\r\n]*)(?:;|$)/i);return n&&(t[n[1]]=n[2]),t},{}),"initial-style"in g&&(i[l]="1"===g["initial-style"])),l in i||(i[l]=o),c[l]=new exsurge.ChantScore(n,s[l],i[l]),g&&g.annotation&&i[l]?c[l].annotation=new exsurge.Annotation(n,g.annotation):r&&(c[l].annotation=new exsurge.Annotation(n,r)),g&&g["user-notes"]&&(c[l].userNotes=g["user-notes"]),g&&g.commentary&&(c[l].commentary=g.commentary)}m()};a.data("setSrc",function(t){g=0;var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&200===e.status&&a.attr("src")===t&&u(e.responseText)},e.open("GET",t,!0),e.send(null)});var l=this.getAttribute("src");l?a.data("setSrc")(l):u(this.innerText,this.getAttribute("annotation"));var g=0,p=function(){var t=r.parentElement.clientWidth||window.document.body.clientWidth;if(g!==t){g=t;for(var e="",a=0;a<c.length;++a)(c[a].userNotes||c[a].commentary)&&(e+="<br>"),c[a].userNotes&&(e+="<i>"+c[a].userNotes+"</i>"),c[a].commentary&&(e+='<i style="float:right">'+c[a].commentary+"</i>"),c[a].performLayout(n),c[a].layoutChantLines(n,g),e+=c[a].createSvg(n);r.innerHTML=e}},d=!1,m=function(){p(),d||(window.addEventListener?window.addEventListener("resize",p,!1):window.attachEvent&&window.attachEvent("onresize",p))}},e.attachedCallback=function(){},document.registerElement=document.registerElement||function(){};document.registerElement("chant-gabc",{prototype:e})});