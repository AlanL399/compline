$(function(e){"use strict";var t=Object.create(HTMLElement.prototype);t.createdCallback=function(){var t=/((?:[\w-_]+:\s*[^;\r\n]*;?\r?\n)+)%%\r?\n/,n=new exsurge.ChantContext,r=this,a=e(this);n.lyricTextFont="'Crimson Text', serif",n.lyricTextSize*=1.2,n.dropCapTextFont=n.lyricTextFont,n.annotationTextFont=n.lyricTextFont;var o,i=this.getAttribute("use-drop-cap");i="false"!==i;var s,c,l=function(e,r){o=[],s=[],c=[],e=e.replace(/<v>\\([VRA])bar<\/v>/g,function(e,t){return t+"/."}).replace(/(<b>[^<]+)<sp>'(?:oe|œ)<\/sp>/g,"$1œ</b>́<b>").replace(/<b><\/b>/g,"").replace(/<sp>'(?:ae|æ)<\/sp>/g,"ǽ").replace(/<sp>'(?:oe|œ)<\/sp>/g,"œ́").replace(/<v>\\greheightstar<\/v>/g,"*");var a=e.split(t);1===a.length&&a.splice(0,"","");for(var l=(a.length-1)/2,u=0;u<l;++u){var p=a[2*u+1].split(/\r?\n/);e=a[2*u+2].replace(/([^c])u([aeiouáéíóú])/g,"$1u{$2}").replace(/<\/?sc>/g,"%").replace(/<\/?b>/g,"*").replace(/<\/?i>/g,"_").replace(/(\s)_([^\s*]+)_(\(\))?(\s)/g,"$1^_$2_^$3$4").replace(/(\([cf][1-4]\)|\s)(\d+\.)(\s\S)/g,"$1^$2^$3"),s[u]=exsurge.Gabc.createMappingsFromSource(n,e),p&&(p=p.reduce(function(e,t){var n=t.match(/^([\w-_]+):\s*([^;\r\n]*)(?:;|$)/i);return n&&(e[n[1]]=n[2]),e},{}),"initial-style"in p&&(o[u]="1"===p["initial-style"])),u in o||(o[u]=i),c[u]=new exsurge.ChantScore(n,s[u],o[u]),p&&p.annotation&&o[u]?c[u].annotation=new exsurge.Annotation(n,p.annotation):r&&(c[u].annotation=new exsurge.Annotation(n,r)),p&&p["user-notes"]&&(c[u].userNotes=p["user-notes"]),p&&p.commentary&&(c[u].commentary=p.commentary)}m()};a.data("setSrc",function(e){p=0;var t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&200===t.status&&a.attr("src")===e&&l(t.responseText)},t.open("GET",e,!0),t.send(null)});var u=this.getAttribute("src");u?a.data("setSrc")(u):l(this.innerText,this.getAttribute("annotation"));var p=0,g=function(){var e=r.parentElement&&r.parentElement.clientWidth||window.document.body.clientWidth;if(p!==e){p=e;for(var t="",a=0;a<c.length;++a)(c[a].userNotes||c[a].commentary)&&(t+="<br>"),c[a].userNotes&&(t+="<i>"+c[a].userNotes+"</i>"),c[a].commentary&&(t+='<i style="float:right">'+c[a].commentary+"</i>"),c[a].performLayout(n),c[a].layoutChantLines(n,p),t+=c[a].createSvg(n);r.innerHTML=t}},d=!1,m=function(){g(),d||(window.addEventListener?window.addEventListener("resize",g,!1):window.attachEvent&&window.attachEvent("onresize",g))}},t.attachedCallback=function(){},document.registerElement=document.registerElement||function(){};document.registerElement("chant-gabc",{prototype:t})});