$(function(e){"use strict";var t=Object.create(HTMLElement.prototype);t.createdCallback=function(){var t=/((?:[\w-_]+:\s*[^;\r\n]*;?\r?\n)+)%%\r?\n/,n=new exsurge.ChantContext,r=this,a=e(this);n.lyricTextFont="'Crimson Text', serif",n.lyricTextSize*=1.2,n.dropCapTextFont=n.lyricTextFont,n.annotationTextFont=n.lyricTextFont;var o,i=this.getAttribute("use-drop-cap");i="false"!==i;var s,c,u=function(e,r){o=[],s=[],c=[],e=e.replace(/<v>\\([VRA])bar<\/v>/g,function(e,t){return t+"/."}).replace(/<\/?sc>/g,"%").replace(/<\/?b>/g,"*").replace(/<\/?i>/g,"_").replace(/<sp>'(?:ae|æ)<\/sp>/g,"ǽ").replace(/<v>\\greheightstar<\/v>/g,"*");var a=e.split(t);1===a.length&&a.splice(0,"","");for(var u=(a.length-1)/2,l=0;l<u;++l){var g=a[2*l+1].split(/\r?\n/);e=a[2*l+2].replace(/(\s)_([^\s*]+)_(\(\))?(\s)/g,"$1^_$2_^$3$4").replace(/(\([cf][1-4]\)|\s)(\d+\.)(\s\S)/g,"$1^$2^$3"),s[l]=exsurge.Gabc.createMappingsFromSource(n,e),g&&(g=g.reduce(function(e,t){var n=t.match(/^([\w-_]+):\s*([^;\r\n]*)(?:;|$)/i);return n&&(e[n[1]]=n[2]),e},{}),"initial-style"in g&&(o[l]="1"===g["initial-style"])),l in o||(o[l]=i),c[l]=new exsurge.ChantScore(n,s[l],o[l]),g&&g.annotation&&o[l]?c[l].annotation=new exsurge.Annotation(n,g.annotation):r&&(c[l].annotation=new exsurge.Annotation(n,r)),g&&g["user-notes"]&&(c[l].userNotes=g["user-notes"]),g&&g.commentary&&(c[l].commentary=g.commentary)}m()};a.data("setSrc",function(e){g=0;var t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&200===t.status&&a.attr("src")===e&&u(t.responseText)},t.open("GET",e,!0),t.send(null)});var l=this.getAttribute("src");l?a.data("setSrc")(l):u(this.innerText,this.getAttribute("annotation"));var g=0,p=function(){var e=(r.parentElement||window.document.body).clientWidth;if(g!==e){g=e;for(var t="",a=0;a<c.length;++a)(c[a].userNotes||c[a].commentary)&&(t+="<br>"),c[a].userNotes&&(t+="<i>"+c[a].userNotes+"</i>"),c[a].commentary&&(t+='<i style="float:right">'+c[a].commentary+"</i>"),c[a].performLayout(n),c[a].layoutChantLines(n,g),t+=c[a].createSvg(n);r.innerHTML=t}},d=!1,m=function(){p(),d||(window.addEventListener?window.addEventListener("resize",p,!1):window.attachEvent&&window.attachEvent("onresize",p))}},t.attachedCallback=function(){},document.registerElement=document.registerElement||function(){};document.registerElement("chant-gabc",{prototype:t})});