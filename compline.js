$(function(a){"use strict";function t(a){var t=Math.floor(a/100),e=a-19*Math.floor(a/19),r=Math.floor((t-17)/25),n=t-Math.floor(t/4)-Math.floor((t-r)/3)+19*e+15;n-=30*Math.floor(n/30),n-=Math.floor(n/28)*(1-Math.floor(n/28)*Math.floor(29/(n+1))*Math.floor((21-e)/11));var i=a+Math.floor(a/4)+n+2-t+Math.floor(t/4);i-=7*Math.floor(i/7);var s=n-i,o=3+Math.floor((s+40)/44),c=s+28-31*Math.floor(o/4);return moment([a,o-1,c])}function e(a){for(var t=n(a),e=0;e<CalendarSundays.length;++e){var r=CalendarSundays[e];if(r.on){if(a.isSame(s(r.on,a)))return SundayFeast(r,a,t)}else if(r.before){if(a.isBefore(s(r.before,a)))return SundayFeast(r,a,t)}else if(r.after&&a.isAfter(s(r.after,a)))return SundayFeast(r,a,t)}}function r(t){if("liturgical"in t)return t.liturgical;if(0===t.day())return t.liturgical=e(t);if(o(t,"corpusChristi"))return t.liturgical={title:"Corpus Christi",rank:1};if(o(t,"sacredHeart"))return t.liturgical={title:"The Most Sacred Heart of Jesus",rank:1};if(o(t,"ascension"))return t.liturgical={title:"The Ascension of Our Lord",rank:1};if(o(t,"easter-3"))return t.liturgical={title:"Maundy Thursday",rank:1};if(o(t,"easter-2"))return t.liturgical={title:"Good Friday",rank:1};if(o(t,"easter-1"))return t.liturgical={title:"Holy Saturday",rank:1};if(o(t,"lent1-4"))return t.liturgical={title:"Ash Wednesday",rank:5};var r={};if(regionalCalendars){var n=t.format("MM/DD"),i=moment(t).subtract(1,"day").format("MM/DD");a.each(regionalCalendars,function(a,e){if(n in e)r[a]=e[n];else if(i in e){var s=e[i];"ifSunday"===s.plusOne&&1===t.day()&&(r[a]=s)}})}if(Object.keys(r).length&&console.info(r),romanCalendar){if(0===t.day())return t.liturgical=null;var s=t.month(),c=t.date(),l=romanCalendar[s][c];if(!l&&c>1){if(l=romanCalendar[s][c-1],!l||!l.plus)return t.liturgical=null;if("ifLeapYear"===l.plusOne&&!t.isLeapYear())return t.liturgical=null;if("ifSunday"===l.plusOne&&1!==t.day())return t.liturgical=null}return t.liturgical=l}return t.liturgical=null}function n(a){return a.Dates||(a.Dates=new u(a.year()))}function i(a,t,e){if(t[1])return moment([a.year(),parseInt(t[2])-1,parseInt(t[3])]);if(t[5]in e){var r=e[t[5]]||[0];if("function"==typeof r)return e[t[5]](a);var n=moment(r);if(t[7]){var i=parseInt(t[7])||0;"-"==t[6]&&(i*=-1),n.add(i,"days")}return n}return console.info("date not found: "+t[5]),moment("")}function s(a,t){var e=n(t),r=/(?:((\d\d)\/(\d\d))|((\w+)(?:([+-])(\d+))?))(?::(((\d\d)\/(\d\d))|((\w+)(?:([+-])(\d+))?)))?/g,s=r.exec(a);return i(t,s,e)}function o(a,t){for(var e,r,s=n(a),o=/(!)?(?:((\d\d)\/(\d\d))|((\w+)(?:([+-])(\d+))?))(?::(((\d\d)\/(\d\d))|((\w+)(?:([+-])(\d+))?)))?/g;e=o.exec(t);){var c=e[1],l=[i(a,e.slice(1),s)];if(e[9]){if(l.push(i(a,e.slice(9),s)),r=a.isBetween(l[0],l[1],"day","[]"),c&&(r=!r),r)return!0}else if("boolean"==typeof l[0]){if(c&&(l[0]=!l[0]),l[0])return!0}else if(r=a.isSame(l[0],"day"),c&&(r=!r),r)return!0}return!1}var c;a.getJSON("https://freegeoip.net/json/",function(a){console.info("Country: "+a.country_name+"\nCode: "+a.country_code),c=a});var l={},u=function(a){return a in l?l[a]:(this.year=a,this.easter=t(a),this.septuagesima=moment(this.easter).subtract(63,"days"),this.lent1=moment(this.septuagesima).add(21,"days"),this.ascension=moment(this.easter).add(39,"days"),this.pentecost=moment(this.easter).add(49,"days"),this.christmas=moment([a,11,25]),this.advent1=moment(this.christmas).subtract((this.christmas.day()||7)+21,"days"),this.allSouls=moment([a,10,2]),0===this.allSouls.day()&&this.allSouls.add(1,"day"),this.corpusChristi=moment(this.pentecost).add(11,"days"),this.sacredHeart=moment(this.pentecost).add(19,"days"),this.christTheKing=moment([a,9,31]),this.christTheKing.subtract(this.christTheKing.day(),"days"),this.sevenDolors=moment([a,8,15]),this.epiphany=moment([a,0,6]),this.holyFamily=moment(this.epiphany).add(7-(this.epiphany.day()||1),"days"),this.transfiguration=moment([a,7,6]),void(l[a]=this))};u.prototype.firstClassFeast=function(a){var t=r(a);return!(!t||1!==t.rank)},u.prototype.firstOrSecondClassFeast=function(a){var t=r(a);return!(!t||1!==t.rank&&2!==t.rank)},u.prototype.feastOfOurLady=function(a){var t=r(a);return!(!t||!t.ol)},u.prototype.minorFeast=function(a){var t=r(a);return t&&t.rank>1&&t.rank<5},u.prototype.feria=function(a){var t=r(a);return 0!==a.day()&&(!t||t.rank>=5)},u.prototype.sunday=function(a){return 0===a.day()},u.prototype.isTriduum=function(a){var t=moment(this.easter).subtract(3,"days");return a.isSameOrAfter(t)&&a.isBefore(this.easter)},u.prototype.isPaschalWeek=function(a){var t=moment(this.easter).add(6,"days");return a.isSameOrAfter(this.easter)&&a.isBefore(t)},u.prototype.isPaschalTime=function(a){var t=moment(this.easter).add(55,"days");return a.isSameOrAfter(this.easter)&&a.isBefore(t)},u.prototype.isAdvent=function(a){return a.isSameOrAfter(moment(this.advent1).subtract(1,"day"))&&a.isSameOrBefore(moment(this.christmas).subtract(1,"day"))},window.momentFromString=s,a.QueryString=function(a){if(""===a)return{};for(var t={},e=0;e<a.length;++e){var r=a[e].split("=");2==r.length&&(t[r[0]]=decodeURIComponent(r[1].replace(/\+/g," ")))}return t.successMsg&&showAlert(!1,t.successMsg),t.failMsg&&showAlert(!0,t.failMsg),t}(window.location.search.substr(1).split("&"));var d=moment();a("#date").val(d.format("YYYY-MM-DD"));var h=function(a){return function(t,e){var r=moment(e);return r.isValid()?r.add(a,"days"):r=moment(),r.format("YYYY-MM-DD")}},f=function(t){a("#date").val(h(t?7:1)).change()},m=function(t){a("#date").val(h(t?-7:-1)).change()};a(document).on("keypress",function(a){switch(a.which){case 106:case 74:m(a.shiftKey);break;case 107:case 75:f(a.shiftKey)}});var p,y=d.day(),g=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if(a.QueryString.day){var v=a.QueryString.day;v in g?y=v:(v=g.indexOf(v),v in g&&(y=v))}var b="",k=function(t){if(t!==b){b=t;var e="<chant-gabc src='canticle-ant"+t+".gabc'></chant-gabc>";"-pt"===t&&(t="");var r="<chant-gabc src='canticle-psalm"+t+".gabc'></chant-gabc>",n=function(n){var i=e+r+n;i+="-po"===t?"<chant-gabc src='haec-dies.gabc'></chant-gabc>":e,a("#canticle").empty().append(i)};a("#canticle").empty(),a.get("canticle-psalm"+t+".html",n)}},S=function(t,e,r){var n="",i="",s="";"triduum"===t?(t=0,s="-triduum"):"asd"===t?(s="",i="<chant-gabc src='psalms/"+t+"/psalm"+s+".gabc'></chant-gabc>"):(s=e?"-PT":"",n=e?"<chant-gabc src='psalms/ant-PT.gabc'></chant-gabc>":"<chant-gabc src='psalms/"+t+"/ant.gabc'></chant-gabc>","no-antiphon"===e&&(n=""),i="<chant-gabc src='psalms/"+t+"/psalm"+s+".gabc'></chant-gabc>",p=g[t],r||a("#weekday").text(p));var o=function(t){var e=n+i+t+n;a("#placeholder").empty().append(e)};a.get("psalms/"+t+"/psalm-verses"+s+".html",o).fail(function(){a.get("psalms/"+t+"/psalm-verses.html",o)})},M=function(a){switch(a){case 1:return"I Class";case 2:return"II Class";case 3:return"III Class";case 5:return"Commemoration";default:return"Feria"}},w=function(t){var e=n(t);a("[exclude]").each(function(){var e=a(this);e.toggle(!o(t,e.attr("exclude")))}),a("[include]").each(function(){var e=a(this);e.toggle(o(t,e.attr("include")))});var i=function(a){var e=a.attr("select-day");e=!e||o(t,e);var r=o(t,a.attr("select-date"));return r&&e};a("input[select-date]").each(function(){var t=a(this),e=i(t);if(e)t.prop("checked",!0).change();else{var r=t.siblings("input[name="+t.attr("name")+"]");1!=r.length||r.is("[select-date]")||r.prop("checked",!0).change()}}),a("option[select-date]").each(function(){var t=a(this),e=i(t);if(e)t.parent().val(t.val()).change();else{var r=t.siblings("option");1!=r.length||r.is("[select-date]")||t.parent().val(r.val()).change()}});var s=e.isPaschalTime(t),c=0!==t.day();if(s&&e.isPaschalWeek(t))c=!1,S(0,"no-antiphon",!0),k("-po"),a("#weekday").text("Easter "+g[t.day()]);else if(e.isTriduum(t)){c=!1;var l=t.day();S("triduum");var u;switch(l){case 4:u="Maundy Thursday";break;case 5:u="Good Friday";break;case 6:u="Holy Saturday"}a("#weekday").text(u)}else o(t,"allSouls")?(c=!1,a("#weekday").text("All Souls Day"),S("asd"),k("-asd")):(S(t.day(),s),k(s?"-pt":""));a(".chooseDay").toggle(c);var d=r(t),h=a("#rbWeekday").prop("value",t.day());d||(d={title:"Feria",rank:10}),a("#feastDay").text(d.title+(d.rank<5?" ("+M(d.rank)+")":"")),d&&d.rank<=2?a("#rbSunday").prop("checked",!0):h.prop("checked",!0)},C=function(a,t){a&&0!==a.length&&(a.attr("src",t),a.data("setSrc")(t))};a("input[name=weekday]").change(function(){this.checked&&S(parseInt(this.value),"paschal"==T.season,!0)});var O=function(t,e,r){var n=t+"/"+e+".gabc";C(a("#"+t),n);var i=a("chant-gabc["+r+"]");i.length>0&&C(i,i.attr(r)),a("div."+t).hide(),a("div."+t+"."+e).show()},T={};a("[id$=-choices] input[type=radio]").change(function(){var a=this.name;T[a]=this.value,"season"!=a&&O(a,this.value,this.id)}),a("#marian-antiphon-choices select,#marian-antiphon-solemn").change(function(){var t=a("#marian-antiphon-choices select"),e=a("#marian-antiphon-solemn").prop("checked"),r="marian-antiphon",n=t.val(),i=t.find("option[value="+n+"]").prop("id");e&&(n+="-solemn",i+="-solemn"),T[r]=n,O(r,n,i)}),a("#date").change(function(){this.value&&w(moment(this.value))}).change()});